---
title: "STAT331 Data Visualizations and Dashboards - Assignment 2"
author: "Andrew Sparkes"
date: "2025-10-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load_packages, echo=FALSE, include=FALSE}
library(tidyverse)
library(readr)
library(magrittr) # for %>%
library(ggplot2) # mpg dataset and plotting
library(tigris) # for states data
library(sf) # simple features
library(ggrepel) # for repelling labels off of one another
library(scales) # for comma-tizing the y tick labels
```

## Assignment 2


Using data from the Monthly Treasury Datasets create plots with ggplot2 that meet the following requirements:

1.)  You must create 2 plots

2.)  The plots must use two different plot types (boxplot and scatterplot, bar-plot and radar-plot, etc...)

3.)  The plots must encode the data using geometries and aesthetics that follow the best practices that we learned in class.

(You are not required to work with axis labels, titles, customized legends, etc... yet.  We will work on theming next week.)

Submit

1.)  Code

2.)  Plot

3.)  A description of the intent of the plot and what the user should get from looking at the plot.

```{r load_datasets, include = FALSE}
# for now, loading /all/ the data
# TODO cleanup this crap
MTS_AgcyInvest <- readr::read_csv("MTS_AgcyInvest_20150331_20250930.csv")
#readr::spec(MTS_AgcyInvest)
MTS_AgcyIssue <- readr::read_csv("MTS_AgcyIssue_20150331_20250930.csv")
#readr::spec(MTS_AgcyIssue)
MTS_AgcySpecIssue <- readr::read_csv("MTS_AgcySpecIssue_20150331_20250930.csv")
#readr::spec(MTS_AgcySpecIssue)
MTS_BudsRsltFin <- readr::read_csv("MTS_BudRsltFin_20150331_20250930.csv")
#readr::spec(MTS_BudsRsltFin)
MTS_ChgExcsLiab <- readr::read_csv("MTS_ChgExcsLiab_20150331_20250930.csv")
#readr::spec(MTS_ChgExcsLiab)
MTS_FinDfctDispSur <- readr::read_csv("MTS_FinDfctDispSur_20150331_20250930.csv")
#readr::spec(MTS_FinDfctDispSur)
MTS_GuarDirLoan <- readr::read_csv("MTS_GuarDirLoan_20150331_20250930.csv")
#readr::spec(MTS_GuarDirLoan)
MTS_OutlyAgcy <- readr::read_csv("MTS_OutlyAgcy_20150331_20250930.csv")
#readr::spec(MTS_OutlyAgcy)
MTS_RcptOutlyDfctSur <- readr::read_csv("MTS_RcptOutlyDfctSur_20150331_20250930.csv")
#readr::spec(MTS_RcptOutlyDfctSur)
MTS_RcptOutlyMo <- readr::read_csv("MTS_RcptOutlyMo_20150331_20250930.csv")
#readr::spec(MTS_RcptOutlyMo)
MTS_RcptSrc <- readr::read_csv("MTS_RcptSrc_20150331_20250930.csv")
#readr::spec(MTS_RcptSrc)
MTS_RcptSrcOutlyAgcy <- readr::read_csv("MTS_RcptSrcOutlyAgcy_20150331_20250930.csv")
#readr::spec(MTS_RcptSrcOutlyAgcy)
MTS_RcptSrcOutlyFcn <- readr::read_csv("MTS_RcptSrcOutlyFcn_20150331_20250930.csv")
#readr::spec(MTS_RcptSrcOutlyFcn)
MTS_TrustFund <- readr::read_csv("MTS_TrustFund_20150331_20250930.csv")
#readr::spec(MTS_TrustFund)
```




```{r cleanup_and_mangle}
# first, let's figure out what the hell we even want to look at in this enormous dataset

# let's start with the inclass example, looking at the DoJ's transactions
MTS_AgcyInvest_CumSumTrans <- MTS_AgcyInvest %>%
  filter(`Classification Description` == "Department of Justice") %>%
  select(`Record Date`, `Classification Description`, `Current Month Net Transaction Amount`, `Fiscal Year to Date Net Transaction Amount`)  %>%
  mutate(Cumulative.Transaction = cumsum(`Current Month Net Transaction Amount`)) %>%
  rename(Record.Date = `Record Date`) %>% # TODO probably better way to do this in a batch
  rename(Classification.Description = `Classification Description`) %>%
  rename(Current.Month.Net.Transaction.Amount = `Current Month Net Transaction Amount`) %>%
  rename(Fiscal.Year.to.Date.Net.Transaction.Amount = `Fiscal Year to Date Net Transaction Amount`)

```

```{r clean_up_and_mangle_part_two}
# let's poke around the MTS_GuardDirLoan dataset for anything interesting
#colnames(MTS_GuarDirLoan) <- str_replace_all(colnames(MTS_GuarDirLoan), " ", ".") # TODO FUCK YOU Fix me, replace spaces with periods
#
# MTS_GuarDirLoan_CumSums <- MTS_GuarDirLoan |>
#   filter(Classification.Description == "Department of Education:") |>
#   filter(!is.na(Current.Month.Net.Transaction.Amount)) |>
#   select(`Record.Date`, `Classification.Description`, `Current.Month.Net.Transaction.Amount`, `Fiscal.Year.to.Date.Net.Transaction.Amount`)

# DoE is full of null data, yay!
# let's try something else...

# TODO insert more data probing and such here!
#MTS_GuarDirLoan_CumSums <- 
  MTS_RcptSrcOutlyAgcy |>
  filter(`Classification Description` == "Corporation Income Taxes") |>
  group_by(`Classification Description`)
  #filter(Classification.Description == "Department of Education:") |>
  # filter(!is.na(Current.Month.Net.Transaction.Amount))
  #select(`Record.Date`, `Classification.Description`, `Current.Month.Net.Transaction.Amount`, `Fiscal.Year.to.Date.Net.Transaction.Amount`)


  #mutate(Cumulative.Transaction = cumsum(`Current.Month.Net.Transaction.Amount`)) 
  #rename(Record.Date = `Record Date`) %>% # TODO probably better way to do this in a batch
  #rename(Classification.Description = `Classification Description`) %>%
  #rename(Current.Month.Net.Transaction.Amount = `Current Month Net Transaction Amount`) %>%
  #rename(Fiscal.Year.to.Date.Net.Transaction.Amount = `Fiscal Year to Date Net Transaction Amount`)

```


```{r plot_the_stuff_part_one}
# plotting a variation of the inclass example
plot1 <- MTS_AgcyInvest_CumSumTrans %>% 
  ggplot() +
  geom_line(aes(x = Record.Date, y = Cumulative.Transaction)) + # TODO fix this, make it beautiful
  geom_point(aes(x=Record.Date, y=Cumulative.Transaction)) + # add actual data points to plot
  theme_dark() + # TODO Customize me!
  xlab("Date") +
  ylab("Current Balance (USD)") +
  scale_y_continuous(label=comma, limits=c(min(MTS_AgcyInvest_CumSumTrans$Cumulative.Transaction), 
                                           max(MTS_AgcyInvest_CumSumTrans$Cumulative.Transaction))) +
  scale_x_date(date_minor_breaks = "3 month", date_labels = "%b %Y") +
  labs(title="Account Balance for the DOJ",
       subtitle = "From 2017 to Current",
       caption="Monthly Treasury Statement Dataset")

plot1
```


```{r plot_the_things_part_two_electric_boogaloo}
# plot 2 TODO do me!
plot2 <- MTS_AgcyInvest_CumSumTrans %>% 
  ggplot() +
  geom_line(aes(x = Record.Date, y = Cumulative.Transaction), color="red", linewidth = 3) + # TODO fix this, make it beautiful
  geom_point(aes(x=Record.Date, y=Cumulative.Transaction)) + # add actual data points to plot
  theme_dark() +
  xlab("Date") +
  ylab("Current Balance (USD)") +
  scale_y_continuous(label=comma, limits=c(min(MTS_AgcyInvest_CumSumTrans$Cumulative.Transaction), 
                                           max(MTS_AgcyInvest_CumSumTrans$Cumulative.Transaction))) +
  labs(title="Account Balance for the DOJ",
       subtitle = "From 2017 to Current",
       caption="Monthly Treasury Statement Dataset")

plot2
```
